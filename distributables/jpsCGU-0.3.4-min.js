class GameCore{static protectedKeys=["protectedKeys","paper","pen","nextId","getUniqueId","init","interval","scenes"];paper;pen;paperSize={width:width,height:height};static nextId=0;framerate=60;framesCount=0;interval;backgroundColor="white";scenes;currentScene;inputQueue;getUniqueId(){let e=GameCore.nextId;return GameCore.nextId++,e}static init(e,t=new GameSettings){var i=new GameCore;try{i.paper=document.getElementById(e),"HTMLCanvasElement"!=typeof i.paper&&console.log(`Element with id "${e} is of type ${i.paper.tagName} not canvas. Please check spelling and select a canvas element."`)}catch(t){return console.log(`Faild to locate canvas with id "${e}" please verify spelling.`),console.info(t),null}if(!t.width||!t.height)return null;null!==t.width&&(i.paperSize.width=i.paper.width),null!==t.height&&(i.paper.height=t.height),i.paperSize.height=i.paper.height,i.paperSize.width=i.paper.width,delete t.width,delete t.height;for(const[e,o]of Object.entries(t))GameCore.protectedKeys.includes(e)?console.log(`The member '${e}' is a foundational component of GameCore and cannot be overwritten! Please select a new name for the key`):(i[e],i[e]=o);return i.pen=i.paper.getContext("2d"),i.interval=setInterval(i.gameLoop,1e3/i.framerate),i}gameLoop(){this.scenes&&!this.currentScene?this.currentScene=0:(clearInterval(this.interval),console.log(`GameCore associated with canvasId:${this.paper.id} crashed: No scenes defined!`));var e=[],t=[],i=[];this.scenes[this.currentScene].entities.dataEntities.forEach((o=>{switch(o.procLocation){case procLoc.start:e.push(o.proc);break;case procLoc.afterInput:t.push(o.proc);break;case procLoc.end:i.push(o.proc)}})),e.forEach((e=>{"function"==typeof e&&e()})),this.inputQueue.forEach((e=>{e.proc(),e.complete&&this.inputQueue.splice(this.inputQueue.indexOf(e),1)})),t.forEach((e=>{"function"==typeof e&&e()})),this.pen.fillStyle=this.backgroundColor,this.pen.fillRect(0,0,this.paperSize.width,this.paperSize.height),this.scenes[this.currentScene].proc(),this.scenes[this.currentScene].render(),i.forEach((e=>{"function"==typeof e&&e()})),this.scenes[this.currentScene].entities.resoruces.forEach((e=>{e.proc()})),this.framesCount++}}class GameObjectBase{uId;gameCore;proc=null;render=null;constructor(e){this.gameCore=e,this.uId=GameCore.getUniqueId()}}class GameSettings{width=null;height=null;backgroundColor="white";framerate=60}function CreateGameMaster(e){try{this.paper=document.getElementById(e)}catch(e){return console.log("Failed to initialize canvas. Try checking the spelling of your targetID."),void console.info(e)}this.pen=this.paper.getContext("2d"),this.interval=null,this.gameForegroundObjects=[],this.gameBackgroundObjects=[],this.framerate=60,this.framesCount=0,this.backgroundColor="white",this.objectID=1e3,this.init=function(e={width:"default",height:"default"}){NaN!=e.width&&e.width>0&&(this.paper.width=e.width),NaN!=e.height&&e.height>0&&(this.paper.height=e.height),e.framerate&&(this.framerate=e.framerate),e.backgroundColor&&(this.backgroundColor=e.backgroundColor);var t=this;this.interval=window.setInterval((function(){t.gameUpdate(t)}),1e3/this.framerate)},this.gameUpdate=function(e){e.pen||(console.log("Your pen's outta ink mate..."),e.interval.stopInterval()),e.pen.fillStyle=e.backgroundColor,e.pen.fillRect(0,0,e.paper.width,e.paper.height);for(let t=0;t<e.gameBackgroundObjects.length;++t)e.gameBackgroundObjects[t].drawFrame(e);for(let t=0;t<e.gameForegroundObjects.length;++t)e.gameForegroundObjects[t].checkCollisions(e),e.gameForegroundObjects[t].updateFrame(e),e.gameForegroundObjects[t].drawFrame(e),e.gameForegroundObjects[t].markForRemoval&&(e.gameForegroundObjects.splice(t,1),t--);this.drawOverlay(),this.framesCount++},this.drawOverlay=function(){},this.reindexBGObjects=function(){for(let e=0;e<this.gameBackgroundObjects.length;++e)this.gameBackgroundObjects[e].index=e}}function GameBGObject(e,t,i,o,s,n={color:"black"}){this.uniqueID=e.objectID,e.objectID++,this.x=t,this.y=i,this.width=o,this.height=s,this.GameObject=e,this.color=n.color,this.desciption="",this.drawFrame=function(e){e.pen||(console.log("Your pen's outta ink mate..."),e.interval.stopInterval()),e.pen.fillStyle=this.color,e.pen.fillRect(this.x,this.y,this.width,this.height)},this.moveUp=function(){if(this.index===this.GameObject.gameBackgroundObjects.length-1)return console.log("BackgroundObject #"+this.uniqueID+" is already at the top of the render stack!"),void console.info(this);var e=this.GameObject.gameBackgroundObjects[this.index+1];this.GameObject.gameBackgroundObjects[this.index+1]=this,this.GameObject.gameBackgroundObjects[this.index]=e,this.GameObject.gameBackgroundObjects[this.index].index=this.index,this.index++},this.moveDown=function(){if(0===this.index)return console.log("BackgroundObject #"+this.uniqueID+" is already at the bottom of the render stack!"),void console.info(this);var e=this.GameObject.gameBackgroundObjects[this.index-1];this.GameObject.gameBackgroundObjects[this.index-1]=this,this.GameObject.gameBackgroundObjects[this.index]=e,this.GameObject.gameBackgroundObjects[this.index].index=this.index,this.index--},this.moveBefore=function(e){var t="unknown object";for(let i=0;i<this.GameObject.gameBackgroundObjects.length;++i)if(this.GameObject.gameBackgroundObjects[i].uniqueID===e){t=i;break}"unknown object"===t&&console.log("failed to locate GameBGObject #"+e+" please make sure you entered the correct ID."),this.GameObject.gameBackgroundObjects.splice(this.index,1),0===t?this.GameObject.gameBackgroundObjects.unshift(this):this.GameObject.gameBackgroundObjects.splice(t,0,this),this.GameObject.reindexBGObjects()},this.moveAfter=function(e){var t="unknown object";for(let i=0;i<this.GameObject.gameBackgroundObjects.length;++i)if(this.GameObject.gameBackgroundObjects[i].uniqueID===e){t=i;break}this.GameObject.gameBackgroundObjects.splice(this.index,1),"unknown object"===t&&console.log("failed to locate GameBGObject #"+e+" please make sure you entered the correct ID."),t===this.GameObject.gameBackgroundObjects.length-1?this.GameObject.gameBackgroundObjects.push(this):this.GameObject.gameBackgroundObjects.splice(t,0,this),this.GameObject.reindexBGObjects()},this.GameObject.gameBackgroundObjects.push(this),this.index=this.GameObject.gameBackgroundObjects.length-1,n.desciption&&(this.desciption=n.desciption),"function"==typeof n.drawFrame&&(this.drawFrame=n.drawFrame)}function GameFGObject(e,t,i,o,s,n={}){this.uniqueID=e.objectID,e.objectID++,this.GameObject=e,this.x=t,this.y=i,this.width=o,this.height=s,this.type="",this.overlapObjects=[],this.color="black",this.checkCollisions=function(e){this.overlapObjects=[];for(let t=0;t<e.gameForegroundObjects.length;++t){let i=!1;if(this.uniqueID==e.gameForegroundObjects[t].uniqueID&&(i=!0),!i){let i=e.gameForegroundObjects[t];this.x<i.x+i.width&&this.x+this.width>i.x&&this.y<i.y+i.height&&this.height+this.y>i.y&&this.overlapObjects.push(e.gameForegroundObjects[t])}}},this.updateFrame=function(){return!1},this.drawFrame=function(e){this.preDrawFrame&&"function"==typeof preDrawFrame&&this.preDrawFrame(),e.pen.fillStyle=this.color,e.pen.fillRect(this.x,this.y,this.width,this.height),this.postDrawFrame&&"function"==typeof postDrawFrame&&this.postDrawFrame()},e.gameForegroundObjects.push(this),this.index=e.gameForegroundObjects.length-1,this.markForRemoval=!1,this.remove=function(){this.markForRemoval=!0},this.moveUp=function(){if(this.index===this.gameForegroundObjects.length-1)return console.log("ForegroundObject #"+this.uniqueID+" is already at the top of the render stack!"),void console.info(this);var e=this.GameObject.gameForegroundObjects[this.index+1];this.GameObject.gameForegroundObjects[this.index+1]=this.GameObject.gameForegroundObjects[this.index],this.GameObject.gameForegroundObjects[this.index]=e,this.GameObject.gameForegroundObjects[this.index].index=this.index,this.index++},this.moveDown=function(){if(0===this.index)return console.log("ForegroundObject #"+this.uniqueID+" is already at the bottom of the render stack!"),void console.info(this);var e=this.GameObject.gameForegroundObjects[this.index-1];this.GameObject.gameForegroundObjects[this.index-1]=this.GameObject.gameForegroundObjects[this.index],this.GameObject.gameForegroundObjects[this.index]=e,this.GameObject.gameForegroundObjects[this.index].index=this.index,this.index--},this.sendToBack=function(){for(;0!==this.index;)this.moveDown()},this.sendToFront=function(){for(;this.index!==this.gameForegroundObjects.length-1;)this.moveUp()},n.type&&(this.type=n.type),n.color&&(this.color=n.color),"function"==typeof n.updateFrame&&(this.updateFrame=n.updateFrame),"function"==typeof n.drawFrame&&(this.drawFrame=n.drawFrame),"function"==typeof n.preDrawFrame&&(this.preDrawFrame=n.preDrawFrame),"function"==typeof n.postDrawFrame&&(this.postDrawFrame=n.postDrawFrame)}function GameSprite(e,t,i,o,s,n={}){n.debugLogCreation&&console.log("Creating new generic sprite with these attributes.\nurl: "+e+"\nframeW: "+t+"\nframeH: "+i+"\ncolumns: "+o+"\nrows:"+s+"\noptions: "+n),this.uniqueSprite=!0;for(let t=0;t<Sprite.spriteRegistration.length;++t)if(Sprite.spriteRegistration[t].url===e){n.debugLogCreation&&console.log("Sprite created with existing image"),this.image=Sprite.spriteRegistration[t].image,this.uniqueSprite=!1;break}this.image||(n.debugLogCreation&&console.log("Sprite created with new image"),this.image=new Image,this.image.src=e),this.frameW=t,this.frameH=i,this.cols=o,this.rows=s,this.url=e,this.endFrame=s*o-1,this.startFrame=0,this.render=function(e,t,i,o=1){Sprite.render(this,e,t,i,o)},this.nextFrame=function(){this.frame++,this.frame>this.endFrame&&(this.frame=this.startFrame)},this.prevFrame=function(){this.frame--,this.frame<this.startFrame&&(this.frame=this.endFrame)},n.endFrame&&(this.endFrame=n.endFrame),n.startFrame&&(this.startFrame=n.startFrame),"function"==typeof n.render&&(this.render=n.render),"function"==typeof n.nextFrame&&(this.nextFrame=option.nextFrame),"function"==typeof n.prevFrame&&(this.prevFrame=option.prevFrame),this.frame=this.startFrame,this.uniqueSprite&&Sprite.spriteRegistration.push(this)}Sprite={render:function(e,t,i,o,s=1){var n=Math.floor(e.frame/e.rows),r=Math.floor(e.frame%e.rows);t.pen.drawImage(e.image,r*e.frameW,n*e.frameH,e.frameW,e.frameH,i,o,e.frameW*s,e.frameH*s)},spriteRegistration:[]};class BGObject extends GameObjectBase{constructor(e,t){super(e),this.scene=t,this.scene.entities.background.push(this)}color;location={x:x,y:y,originPoint:originPoint.topLeft};dimensions={w:w,h:h};scene;resource=null;getBoundingBox(){let e=new boundingBox;switch(this.location.originPoint){case originPoint.topLeft:e.left=this.location.x,e.top=this.location.y,e.right=this.location.x+this.dimensions.w,e.bottom=this.location.y+this.dimensions.h;break;case originPoint.topRight:e.left=this.location.x-this.dimensions.w,e.top=this.location.y,e.right=this.location.x,e.bottom=this.location.y+this.dimensions.h;break;case originPoint.bottomLeft:e.left=this.location.x,e.top=this.location.y-this.dimensions.h,e.right=this.location.x+this.dimensions.w,e.bottom=this.location.y;break;case originPoint.bottomRight:e.left=this.location.x-this.dimensions.w,e.top=this.location.y-this.dimensions.h,e.right=this.location.x,e.bottom=this.location.y}return e}render(){let e=this.getBoundingBox();this.gameCore.pen.fillStyle=this.color,this.gameCore.pen.fillRect(e.left,e.top,e.left+this.dimensions.w,e.top+this.dimensions.h)}}class DataEntity extends GameObjectBase{constructor(e,t,i){super(e),this.scene=t,this.procLocation=i,this.scene.entities.dataEntities.push(this)}scene;procLocation}const procLoc=Object.freeze({start:"___START___",afterInput:"___AFTER_INPUT___",end:"___END___"});class FGObject extends GameObjectBase{constructor(e,t){super(e),this.scene=t,this.scene.entities.foreground.push(this)}color;location={x:x,y:y,originPoint:originPoint.topLeft};dimensions={w:w,h:h};getBoundingBox(){let e=new boundingBox;switch(this.location.originPoint){case originPoint.topLeft:e.left=this.location.x,e.top=this.location.y,e.right=this.location.x+this.dimensions.w,e.bottom=this.location.y+this.dimensions.h;break;case originPoint.topRight:e.left=this.location.x-this.dimensions.w,e.top=this.location.y,e.right=this.location.x,e.bottom=this.location.y+this.dimensions.h;break;case originPoint.bottomLeft:e.left=this.location.x,e.top=this.location.y-this.dimensions.h,e.right=this.location.x+this.dimensions.w,e.bottom=this.location.y;break;case originPoint.bottomRight:e.left=this.location.x-this.dimensions.w,e.top=this.location.y-this.dimensions.h,e.right=this.location.x,e.bottom=this.location.y}return e}proc=null;render(){let e=this.getBoundingBox();this.gameCore.pen.fillStyle=this.color,this.gameCore.pen.fillRect(e.left,e.top,e.left+this.dimensions.w,e.top+this.dimensions.h)}}class boundingBox{left;top;right;bottom}const originPoint=Object.freeze({topLeft:0,topRight:1,bottomLeft:2,bottomRight:3});class InputAction{keyword;complete;proc;constructor(e){this.keyword=e}static queue(e,t){if("string"!=typeof t)return console.log(`Input binding failed: keyword must be of type 'string' but was provided type '${typeof t}.'`),!1;let i=new InputAction(e,t);return e.inputQueue.push(i),!0}}class ResourceFile extends GameObjectBase{constructor(e,t){}url;image;scene;proc(){let e=!1,t=[];t=t.concat(this.scene.entities.background,this.scene.entities.foreground);for(let i=0;i<t.length;++i){let o=t[i],s=t[t.length-1-i];if(o.resource&&o.resource.uId===this.uId||s.resource&&s.resource.uId==this.uId){e=!0;break}}e||this.scene.removeResource(this.uId)}}class Scene extends GameObjectBase{constructor(e){super(e)}backgroundColor=null;entities={foreground:foreground,background:background,resoruces:resoruces,dataEntities:dataEntities,getTotalEntities:function(e=null){if(null!==e){var t=0;return"string"==typeof e?this[e]&&(t+=this[e].length):e.forEach((e=>{this[e]&&(t+=this[e].length)})),t}return this.foreground.length+this.background.length+this.resoruces.length}};removeResource(e){for(let t=0;t<this.entities.resoruces.length;t++)if(this.entities.resoruces[t].uId==e)return void this.entities.resoruces.splice(t,1)}proc(){this.entities.foreground.forEach((e=>{"function"==typeof e&&e.proc()}))}render(){(this.backgroundColor||this.backgroundColor!==this.gameCore.backgroundColor)&&(this.gameCore.pen.fillStyle=this.backgroundColor,this.gameCore.pen.fillRect(0,0,this.gameCore.paperSize.width,this.gameCore.paperSize.height)),this.entities.background.forEach((e=>{"function"==typeof e.render&&e.render()})),this.entities.foreground.forEach((e=>{"function"==typeof e.render&&e.render()}))}}
